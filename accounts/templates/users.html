<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Envitus</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link href="{% static 'css/main.css' %}" rel="stylesheet" type="text/css"/>
    <!-- Latest compiled and minified CSS -->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"-->
    <!--          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">-->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <!-- Optional theme -->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"-->
    <!--          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">-->

    <!-- Latest compiled and minified JavaScript -->
    <!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"-->
    <!--            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"-->
    <!--            crossorigin="anonymous"></script>-->

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Envitus</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                    aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link" href="#">Dashboard</a>
                    <a class="nav-link" href="#">Devices</a>
                    <a class="nav-link" href="#">Live Data</a>
                    <a class="nav-link" href="#">Users</a>
                    <a class="nav-link" href="#">Alaram rule</a>
                    <a class="nav-link" href="#">Active Alaram</a>
                    <a class="nav-link" href="#">Alaram Key</a>
                    <a class="nav-link" href="#">Diagnostics</a>
                    <a class="nav-link" href="#">logout</a>
                </div>
            </div>
        </div>
    </nav>
</head>
<body>
<!-- Modal Section -->
<div class="container mt-5">
    <div class="bg-modal">
        <div class="modal-contents">

            <div class="close">+</div>
            <label class="form-label">Roles</label><br>
            <select onchange="updateRole(this.value)" aria-label="Default select" class="form-control" name="user roles"
                    placeholder="Select Role" required type="input">

                <option Select>Update Your Role</option>
                {% for role in roles %}
                <option value={{role}}>{{role}}</option>
                {% endfor %}
            </select>
            <a href="#" class="button" type="submit" onclick="editUserRole()">Update</a>


        </div>
    </div>

    <table class="table">
        <thead>
        <tr>
            <th scope="col">No</th>
            <th scope="col">Users</th>
            <th scope="col">Name</th>
            <th scope="col">Role</th>
            <th scope="col">Operation</th>
        </tr>
        </thead>
        <tbody>
        {% for user in users %}
        <tr>
            <th scope="row"></th>
            <td>{{ user }}</td>
            <td>{{ user.get_first_name }}</td>
            <td>{{ user.role }}</td>
            <td>
                <a href="#" id="button" onclick='openModal("{{user}}")' class="button">
                    <ion-icon name="pencil-outline"></ion-icon>
                </a>
                <a href="deleteuser/{{ user.id }}" class="button">
                    <ion-icon name="trash-outline"></ion-icon>
                </a>
                <a href="userprofile/{{user.username }}" class="button">
                    <ion-icon name="eye-outline"></ion-icon>
                </a>
            </td>

        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</div>
<script>
document.querySelector('.bg-modal').style.display = "none"
const openModal = (user)=>{
    // console.log(user)
    document.querySelector('.bg-modal').style.display = "block";
    localStorage.setItem("username",user)
<!--    loadDoc(user)-->
    // updateRole(username,)
}
let userRole
let userName
const updateRole = (role)=>{
    // console.log('USER NAME : ',username)
    let username = localStorage.getItem("username")
    console.log('USER NAME : ',username)
    console.log('Role : ',role)
    userRole = role
    userName = username
    // loadDoc(username,role)
}
const editUserRole = ()=>{
    loadDoc(userName,userRole)
}

function loadDoc(username,role) {
    console.log('dsdsd')


  $.ajax({
            type: "POST",
            url: "http://127.0.0.1:8000/users/roles/",
            contentType: 'application/json;charset=UTF-8',
            data: JSON.stringify({'username':  username,'role':role}),
            success: function (data) {
                console.log(data);

            }
     });
}


document.querySelector('.close').addEventListener("click", function() {
	document.querySelector('.bg-modal').style.display = "none";
});

const editRole = (userId)=>{
    console.log('Edti role',userId)
}









</script>
</body>
</html>